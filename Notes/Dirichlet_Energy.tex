%        File: Dirichlet Energy.tex
%     Created: Fri Dec 02 07:00 PM 2022 G
% Last Change: Fri Dec 02 07:00 PM 2022 G
%
\documentclass[a4paper]{article}
\usepackage[]{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{mathtools}



\newcommand{\llangle}{\langle \langle}
\newcommand{\rrangle}{\rangle \rangle}
\newcommand{\dx}{\, \text{d} x}
\newcommand{\dxx}{\, \text{d} \mathbf{x}}


\theoremstyle{definition}
\newtheorem{definition}{Definition}

\DeclareMathOperator{\grad}{grad}

\title{Dirichlet Energy in Different Spaces}
\author{ }

\begin{document}
\maketitle
\section{Relevant Definitions}
\begin{definition}[Gradient Flow]
    Given an energy (functional) $\mathcal{E}(f)$, \emph{gradient flow} is:
    \begin{equation}
        \frac{d}{dt}f = - \grad \mathcal{E}(f)
        \label{equ: Gradient Flow}
    \end{equation}
\end{definition}

\begin{definition}[Differential]
    \emph{Differential} $d\mathcal{E}$ describes change in $\mathcal{E}$ due to\footnote{analogous in traditional vector space would be ``in the direction of'' $u$} $u$:
    \begin{equation}
        d \mathcal{E}|_f(u) = \lim_{\epsilon \rightarrow 0} \frac{1}{\epsilon} \left( \mathcal{E}(f+\epsilon u) - \mathcal{E}(f) \right)
        \label{equ: Differential}
    \end{equation}
\end{definition}

\begin{definition}[Gradient]
    \emph{Gradient} of $\mathcal{E}$ is the unique function $\grad \mathcal{E}$ such that,
    \begin{equation}
        \llangle \grad \mathcal{E}, u \rrangle_V = d \mathcal{E}(u)
        \label{equ: Gradient}
    \end{equation}
\end{definition}

\section{Dirichlet Energy Example}

\begin{definition}[Dirichlet Energy]
    Dirichlet Energy is defined as:
    \begin{equation}
        \mathcal{E}_D(f) \coloneqq \frac{1}{2} \int_{\Omega} |\grad f(x)|^2 \dx
        = \frac{1}{2} \llangle \nabla f, \nabla f \rrangle_{L^2}
        = -\frac{1}{2} \llangle \Delta f, f \rrangle_{L^2}
        \label{equ: Dirichlet Energy}
    \end{equation}
\end{definition}

Computing the differential $d \mathcal{E}_D|_f (u)$ of Dirichlet energy using (\ref{equ: Differential}),
\begin{align}
    d \mathcal{E}_D|_f(u) &= -\frac{1}{2} \lim_{\epsilon \rightarrow 0} \frac{1}{\epsilon} \left( \llangle \Delta (f+\epsilon u), f + \epsilon u \rrangle_{L^2} - \llangle \Delta f, f \rrangle_{L^2} \right) \\
    &= -\frac{1}{2} \lim_{\epsilon \rightarrow 0} \frac{1}{\epsilon} \left( \epsilon \llangle \Delta f, u \rrangle_{L^2} + \epsilon \llangle \Delta u, f \rrangle_{L^2} + \epsilon^2 \llangle u, u \rrangle_{L^2} \right) \\
    &= -\frac{1}{2} (\llangle \Delta f,u \rrangle_{L^2} + \llangle \Delta u, f \rrangle_{L^2}) \\
    &= -\frac{1}{2} (\llangle \Delta f,u \rrangle_{L^2} + \llangle \Delta f, u \rrangle_{L^2}) \\
    &= -\llangle \Delta f, u \rrangle_{L^2}
    \label{equ: Dirichlet Differential}
\end{align}
where the last step is by integration by parts (twice)\footnote{This trick will be used all over the place when constructing gradients. See \ref{sct: IBP Justification} in the Appendix}.

\subsection{Gradient Flow in $L^2$}
By (\ref{equ: Gradient}), we may spot from (\ref{equ: Dirichlet Differential}) that the gradient can be written as
\begin{equation}
    \grad \mathcal{E}_{L^2} = - \Delta f
    \label{equ: L2 Gradient}
\end{equation}
Hence, the gradient flow equation (\ref{equ: Gradient Flow}) can be written as:
\begin{equation}
    \frac{d}{dt} f = \Delta f
    \label{equ: L2 Gradient Flow}
\end{equation}
which is the heat equation.


\subsection{Gradient Flow in $H^1$}
We may express the differential (\ref{equ: Dirichlet Differential}) as
\begin{align}
    d \mathcal{E}_D|_f (u) &= - \llangle \Delta f, u \rrangle_{L^2} \\
    &= \llangle \nabla f, \nabla u \rrangle_{L^2} \\
    &= \llangle f, u \rrangle_{H^1}
    \label{equ: Gradient H1 Derivation}
\end{align}
So by (\ref{equ: Gradient}), the gradient in $H^1$ can be written as
\begin{equation}
    \grad \mathcal{E}_{H^1} = f
    \label{equ: H1 Gradient}
\end{equation}
The gradient flow equation (\ref{equ: Gradient Flow}) can be written as
\begin{equation}
    \frac{d}{dt}f = -f
    \label{equ: H1 Gradient Flow}
\end{equation}
which describes exponential decay.

\subsection{Gradient Flow in $H^{-1}$}
We may express the differential (\ref{equ: Dirichlet Differential}) as
\begin{align}
    d \mathcal{E}_D|_f (u) &= - \llangle \Delta f, u \rrangle_{L^2} \\
    &= \llangle \nabla f, \nabla u \rrangle_{L^2} \\
    &= \llangle \nabla^3 f, \nabla^{-1} u \rrangle_{L_2} \\
    &= \llangle \Delta f, \Delta^{-1} u \rrangle_{H^1} \\
    &= \llangle \Delta^2 f, u \rrangle_{H^{-1}}
    \label{equ: Gradient H-1 Derivation}
\end{align}
So by (\ref{equ: Gradient}), the gradient in $H^{-1}$ can be written as
\begin{equation}
    \grad \mathcal{E}_{H^{-1}} = \Delta^2 f
    \label{equ: H-1 Gradient}
\end{equation}
The gradient flow equation (\ref{equ: Gradient Flow}) can be written as
\begin{equation}
    \frac{d}{dt}f = - \Delta^2 f
    \label{equ: H-1 Gradient Flow}
\end{equation}

\subsection{Gradient Flow in $H^2$}
We may express the differential (\ref{equ: Dirichlet Differential}) as
\begin{align}
    d \mathcal{E}_D|_f (u) &= - \llangle \Delta f, u \rrangle_{L^2} \\
    &= -\llangle f, \Delta u \rrangle_{L^{2}} \\
    &= -\llangle \Delta^{-1} f, u \rrangle_{H^2}
    \label{equ: Gradient H2 Derivation}
\end{align}
So by (\ref{equ: Gradient}), the gradient in $H^2$ can be written as
\begin{equation}
    \grad \mathcal{E}_{H^2} = - \Delta^{-1} f
    \label{equ: H2 Gradient}
\end{equation}
The gradient flow equation (\ref{equ: Gradient Flow}) can be written as
\begin{equation}
    \frac{d}{dt}f = \Delta^{-1} f
    \label{equ: H2 Gradient Flow}
\end{equation}


\section{Numerically Solving Gradient Flow Equations}
\subsection{Gradient Flow in $L^2$, $H^1$}
For $L^2$, given the gradient flow equation (\ref{equ: L2 Gradient Flow}),
we may write down explicit Euler scheme:
\begin{equation}
    \frac{f_j^{m+1} - f_j^m}{\Delta t} = \frac{f_{j+1}^m - 2 f_{j}^m + f_{j-1}^m}{(\Delta x)^2}
    \label{equ: L2 Numeric}
\end{equation}
which can be rewritten as
\begin{equation}
    f_{j}^{m+1} = f_j^m + \mu \left( f_{j+1}^m - 2 f_{j}^m + f_{j-1}^m \right)
\end{equation}
where $\mu \coloneqq \frac{\Delta t}{(\Delta x)^2}$ is called the \emph{CFL number}.

Similar construction can be done for $H^1$.

This method is known to have consistency error
\begin{equation}
    T_j^m = \mathcal{O}\left( \left( \Delta x \right)^2 + \Delta t \right)
    \label{L2 Consistency Error}
\end{equation}

\subsection{Gradient Flow in $H^1$}
Given the gradient flow equation (\ref{equ: H1 Gradient Flow}),
we may write down explicit Euler scheme:
\begin{equation}
    \frac{f_j^{m+1} - f_j^m}{\Delta t} = -f_{j}^m
    \label{equ: H1 Numeric}
\end{equation}
which can be rewritten as
\begin{equation}
    f_j^{m+1} = f_j^m - (\Delta t)f_j^m
\end{equation}

%This method is known to have consistency error
%\begin{equation}
%    T_j^m = \mathcal{O}\left( \left( \Delta x \right)^2 + \Delta t \right)
%    \label{H1 Consistency Error}
%\end{equation}

\subsection{Gradient Flow in $H^{-1}$}
Given the gradient flow equation (\ref{equ: H-1 Gradient Flow}), it can be rewritten as
\begin{equation}
    \frac{d}{dt} \Delta f = f
\end{equation}
we may write down explicit Euler scheme:
\begin{equation}
    \frac{1}{\Delta t}\left( \frac{f_{j+1}^{m+1} - 2f_j^{m+1} + f_{j-1}^{m+1}}{\left( \Delta x \right)^2} - \frac{f_{j+1}^{m} - 2f_j^{m} + f_{j-1}^{m}}{\left( \Delta x \right)^2} \right) = f_j^m
    \label{equ: H-1 Numeric}
\end{equation}
which can be rewritten as
\begin{equation}
    \begin{pmatrix}
        1 & -2 & 1
    \end{pmatrix}
    \begin{pmatrix}
        f_{j-1}^{m+1} \\
        f_{j}^{m+1} \\
        f_{j+1}^{m+1}
    \end{pmatrix}
    =
    \begin{pmatrix}
        1 & -2 + \Delta t (\Delta x)^2 & 1
    \end{pmatrix}
    \begin{pmatrix}
        f_{j-1}^{m} \\
        f_{j}^{m} \\
        f_{j+1}^{m}
    \end{pmatrix}
\end{equation}
Assuming Dirichlet boundary condition $f_0^m = a$ and $f_J^m = b$,
we may write this as a matrix equation:
\begin{align*}
    &\begin{pmatrix}
        -2 & 1 \\
        1 & -2 & 1 \\
        & 1 & -2 & 1 \\
        \vdots \\
        & & & & & 1 & -2 & 1 \\
        & & & & & & 1 & -2
    \end{pmatrix}
    \begin{pmatrix}
        f_1 \\
        f_2 \\
        f_3 \\
        \vdots \\
        f_{J-4} \\
        f_{J-3} \\
        f_{J-2} \\
        f_{J-1}
    \end{pmatrix}^{m+1}
    \\
    &=
    \begin{pmatrix}
        -2 + \Delta t (\Delta x)^2 & 1 \\
        1 & -2 + \Delta t (\Delta x)^2  & 1 \\
        & 1 & -2 + \Delta t (\Delta x)^2 & 1 \\
        \vdots \\
        & & & & & 1 & -2 + \Delta t (\Delta x)^2 & 1 \\
        & & & & & & 1 & -2
    \end{pmatrix}
    \begin{pmatrix}
        f_1 \\
        f_2 \\
        f_3 \\
        \vdots \\
        f_{J-4} \\
        f_{J-3} \\
        f_{J-2} \\
        f_{J-1}
    \end{pmatrix}^{m}
\end{align*}
This method has consistency error
\begin{equation}
    T_j^m = \mathcal{O}\left( \left( \Delta x \right)^2 + (\Delta t)^2 \right)
    \label{H1 Consistency Error}
\end{equation}


\newpage
\section{Appendix}
\subsection{A (Somewhat) Careful Justification for IBP}
\label{sct: IBP Justification}
Suppose we are concerned with the integral $I \coloneqq \llangle \Delta u, f \rrangle_{L^2} = \int_{R} (\Delta u)f \dxx$, where $R$ is a bounded region with boundary $\partial R$.
%We may assume that $u$ and $f$ decays sufficiently fast for the integral to be defined.

%\subsubsection{IBP (on Laplacian Operator)}
%Note the vector calculus identity\footnote{Sometimes known as \emph{Green's identity}}:
%\begin{equation}
%    \psi \nabla^2 \phi - \phi \nabla^2 \psi = \nabla \cdot \left( \psi \nabla \phi - \phi \nabla \psi \right)
%    \label{equ: Green's Identity}
%\end{equation}
%
%Now, we can think of $I$ as an integral $I_R$ over a spherical region of radius $R$, and taking the radius $R$ to be infinite,
%that is $I_R \stackrel{R \rightarrow \infty}{\longrightarrow} I$.
%
%We use (\ref{equ: Green's Identity}), taking $\phi = u$, $\psi = f$, to shift the Laplacian:
%\begin{align}
%    I_R &= \int_{V_R} (\nabla^2 u) f \dxx \\
%    &= \int_{V_R} u \nabla^2 f \dxx + \int_{V_R} \nabla \cdot \left( f \nabla u - u \nabla f \right) \dxx \\
%    &= \int_{V_R} u \nabla^2 f \dxx + \int_{\partial V_R} \left( f \nabla u - u \nabla f \right) \cdot \, \text{d} \mathbf{S} \\
%    &\stackrel{R \rightarrow \infty}{\longrightarrow}
%    \int_{\mathbb{R}^n} u \nabla^2 f \dxx \\
%    &= \llangle u, \Delta f \rrangle_{L^2}
%    \label{equ: Sufficient Decay on Boundary}
%\end{align}
%where (\ref{equ: Sufficient Decay on Boundary}) is from assuming sufficiently fast decay of $f$ and $u$ at infinity.
%The limit quantity should equal $I$.

\subsubsection{IBP (on Gradient Operator)}
One could show that 
\begin{equation}
    \llangle \Delta u, f \rrangle_{L^2} = - \llangle \nabla u, \nabla f \rrangle_{L^2} = - \int_{R} \nabla u \cdot \nabla f \dxx
    \label{equ: IBP Gradient}
\end{equation}
using the identity\footnote{This is also known as Green's Identity in some literature}:
\begin{equation}
\nabla \cdot \left( \phi \nabla \psi \right) = \phi \nabla^2 \psi + \nabla \phi \cdot \nabla \psi
    \label{equ: Green's Identity II}
\end{equation}

Note that
\begin{align}
    \llangle \Delta u, f \rrangle_{L^2} &= - \int_R \nabla u \cdot \nabla f \dxx \\
    &= \int_R \nabla \cdot \left( f \nabla u \right) \dxx - \int_R \nabla u \cdot \nabla f \dxx \\
    &= \oint_{\partial R} f \frac{du}{dn} \, \text{d} s - \int_R \nabla u \cdot \nabla f \dxx
\end{align}
(Need the first term of last line to be zero\dots)


\end{document}


